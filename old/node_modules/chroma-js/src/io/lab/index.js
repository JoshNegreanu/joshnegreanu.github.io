import { unpack, type } from 'chroma-js/src/utils';
import chroma from 'chroma-js/src/chroma';
import Color from 'chroma-js/src/Color';
import input from 'chroma-js/src/io/input';
import lab2rgb from 'chroma-js/src/io/lab/lab2rgb';
import rgb2lab from 'chroma-js/src/io/lab/rgb2lab';
import { getLabWhitePoint, setLabWhitePoint } from 'chroma-js/src/io/lab/lab-constants';

Color.prototype.lab = function () {
    return rgb2lab(this._rgb);
};

const lab = (...args) => new Color(...args, 'lab');
Object.assign(chroma, { lab, getLabWhitePoint, setLabWhitePoint });

input.format.lab = lab2rgb;

input.autodetect.push({
    p: 2,
    test: (...args) => {
        args = unpack(args, 'lab');
        if (type(args) === 'array' && args.length === 3) {
            return 'lab';
        }
    }
});

export { lab, getLabWhitePoint, setLabWhitePoint };
